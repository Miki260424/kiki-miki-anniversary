<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="favourites.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=add_box" />
    <title>Document</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>
    <script src="database-helpers.js"></script>
</head>

<body>
    <nav>
        <h1>Kiki + Miki</h1>
    </nav> 
    <div id="popUpWindow">
        <div class="btnHolder">
            <h3 class="backBtn" id="backBnt">Back</h3>
        </div>
        <div class="searchHolder">
            <input class="searchFld" type="search" placeholder="Type the song name">
            <button class="searchBtn">Search</button>
        </div>
    </div>
    <div id="shadow"></div>
    <div class="wrapper">
        <section class="sectionFav">
            <div class="texts">
                <h2 class="title">Our songs</h2>
                <h3 class="addBtn" id="addBtn">Add
                    <span class="material-symbols-outlined">
                        add_box
                    </span>
                </h3>
            </div>
            <div class="gridItems">
                <div class="exampleDiv"></div>
                <div class="exampleDiv"></div>
                <div class="exampleDiv"></div>
                <div class="exampleDiv"></div>
                <div class="exampleDiv"></div>
                <div class="exampleDiv"></div>
            </div>
        </section>
        <section class="sectionFav">
            <div class="texts">
                <h2 class="title">Our songs</h2>
                <h3>Add
                    <span class="material-symbols-outlined">
                        add_box
                    </span>
                </h3>
            </div>
            <div class="gridItems">
                <div class="exampleDiv"></div>
                <div class="exampleDiv"></div>
                <div class="exampleDiv"></div>
                <div class="exampleDiv"></div>
                <div class="exampleDiv"></div>
                <div class="exampleDiv"></div>
            </div>
        </section>
    </div>
    <script>
        checkAuthentication();

        // Load favourites from database when page loads
        window.addEventListener('load', async function() {
            await loadFavourites();
        });

        // Function to load all favourites
        async function loadFavourites() {
            try {
                const favourites = await getAllFavourites();
                const songsGrid = document.getElementById('songsGrid');

                // Clear existing items if you want
                // Or keep them and just add new ones

                // Add each favourite
                favourites.forEach(fav => {
                    if (fav.type === 'song') {
                        addSongToGrid(fav);
                    } else if (fav.type === 'movie') {
                        addMovieToGrid(fav);
                    }
                });
            } catch (error) {
                console.error("Error loading favourites:", error);
            }
        }



        


// When user clicks to add a song
document.querySelector('.searchBtn').addEventListener('click', async function() {
    const songName = document.querySelector('.searchFld').value.trim();
    
    if (!songName) {
        alert("Please enter a song name!");
        return;
    }

    // You can prompt for more details or use a form
    const artistName = prompt("Artist name (optional):");
    const spotifyUrl = prompt("Spotify URL (optional):");

    try {
        this.textContent = "Adding...";
        this.disabled = true;

        const songData = {
            name: songName,
            artist: artistName || "",
            spotifyUrl: spotifyUrl || ""
        };

        const songId = await addFavouriteSong(songData);
        songData.id = songId;
        songData.type = 'song';

        // Add to grid
        addSongToGrid(songData);

        // Reset and close
        document.querySelector('.searchFld').value = "";
        document.getElementById('popUpWindow').style.display = "none";
        document.getElementById('shadow').style.display = "none";
        document.body.style.overflow = "visible";

        this.textContent = "Search";
        this.disabled = false;

        alert("Song added! ðŸŽµ");

    } catch (error) {
        console.error("Error adding song:", error);
        alert("Error adding song. Please try again.");
        this.textContent = "Search";
        this.disabled = false;
    }
});















// Function to add song to grid
function addSongToGrid(song) {
    const songsGrid = document.querySelector('.gridItems'); // Adjust selector if needed
    const songDiv = document.createElement('div');
    songDiv.className = 'exampleDiv';
    songDiv.setAttribute('data-song-id', song.id);
    songDiv.innerHTML = `
        <div style="height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px;">
            <h3 style="margin-bottom: 10px;">${song.name}</h3>
            <p style="color: gray; font-size: 14px;">${song.artist || 'Unknown Artist'}</p>
            ${song.spotifyUrl ? `<a href="${song.spotifyUrl}" target="_blank" style="margin-top: 10px; color: #ff758f; text-decoration: none;">ðŸŽµ Listen</a>` : ''}
        </div>
    `;
    songsGrid.appendChild(songDiv);
}


        let btnClicked = false;
        let shadow = document.getElementById("shadow");
        let backBnt = document.getElementById("backBnt").addEventListener("click", function () {
            shadow.style.display = "none";
            popUpWindow.style.display = "none";
            document.getElementsByTagName("body")[0].style.overflow = "visible";

            btnClicked = false;
        })
        let popUpWindow = document.getElementById("popUpWindow");
        let addBtn = document.getElementById("addBtn").addEventListener("click", function () {
            if (btnClicked === false) {
                shadow.style.display = "block";
                popUpWindow.style.display = "flex";
                document.getElementsByTagName("body")[0].style.overflow = "hidden";
                console.log("clicked");
                btnClicked = true;
            }
        });
    </script>
</body>

</html>